#!/bin/env bash
source $AFYZHOME/config
PluginListFile="$AFYZHOME/Manage/Plugin.json"
TitleText="AF-Plugin"

function InstallGitPlugin(){
unset PluginNameAll LocalPluginGitList LocalPackageNameList InstalledPlugin Options j i
function getPluginList(){
CloudPluginNameList="$(jq -r 'keys[]' ${PluginListFile})"
LocalPluginNameList="$(ls plugins -I example -I other -I system)"
for i in ${LocalPluginNameList}
do
  if [ -e plugins/${i}/.git/config ]
  then
    j="$(grep url ./plugins/${i}/.git/config | sed 's|url =||g')"
  fi
  LocalPluginGitList="${j} ${LocalPackageNameList}"
done
for i in ${LocalPluginNameList}
do
  if [ -e plugins/${i}/package.json ]
  then
    j="$(jq -r '.name' plugins/${i}/package.json)"
  fi
  LocalPackageNameList="${j} ${LocalPackageNameList}"
done
unset i
n=0
for i in ${CloudPluginNameList}
do
  n=$((${n}+1))
  echo -en '\r'${yellow}æ­£åœ¨å¤„ç†æ’ä»¶æ•°æ® ${green}å·²å¤„ç† ${cyan}${n} é¡¹${background}
  CloudPluginGitee=$(eval $(echo "jq -r '.[\"${i}\"].Repository.Gitee' ${PluginListFile}"))
  CloudPluginGithub=$(eval $(echo "jq -r '.[\"${i}\"].Repository.Github' ${PluginListFile}"))
  CloudPackageName=$(eval $(echo "jq -r '.[\"${i}\"].PackageName' ${PluginListFile}"))
  if [ -d plugins/${i} ]
  then
    InstallationStatus="[å·²å®‰è£…]"
    InstalledPluginList="${InstalledPlugin} ${i}"
  elif echo ${LocalPluginGitList} | grep -q ${CloudPluginGitee}
  then
    InstallationStatus="[å·²å®‰è£…]"
    InstalledPluginList="${InstalledPlugin} ${i}"
  elif echo ${LocalPluginGitList} | grep -q ${CloudPluginGithub}
  then
    InstallationStatus="[å·²å®‰è£…]"
    InstalledPluginList="${InstalledPlugin} ${i}"
  elif echo ${LocalPackageNameList} | grep -q ${CloudPackageName}
  then
    InstallationStatus="[å·²å®‰è£…]"
    InstalledPluginList="${InstalledPlugin} ${i}" 
  else
    InstallationStatus="[æœªå®‰è£…]"
  fi
  Options="${Options} ${i} ${InstallationStatus} ${OFF}"
done
echo
}
function getGitURL(){
j=$1
if CheckNetwork
then
  GitSite=Gitee
else
  GitSite=Github
fi
local Git=$(eval $(echo "jq -r '.[\"${j}\"].Repository.${GitSite}' ${PluginListFile}"))
if [ ${Git} == No ]
then
  case ${GitSite} in
    Gitee)
      GitURL="https://github.com/$(eval $(echo "jq -r '.[\"${j}\"].Repository.Github' ${PluginListFile}"))"
    ;;
    Github)
      GitURL="https://gitee.com/$(eval $(echo "jq -r '.[\"${j}\"].Repository.Gitee' ${PluginListFile}"))"
    ;;
  esac
else
  case ${GitSite} in
    Gitee)
      GitURL="https://gitee.com/$(eval $(echo "jq -r '.[\"${j}\"].Repository.Gitee' ${PluginListFile}"))"
    ;;
    Github)
      GitURL="https://github.com/$(eval $(echo "jq -r '.[\"${j}\"].Repository.Github' ${PluginListFile}"))"
    ;;
  esac
fi
echo ${GitURL}
}
function DependenciesInstall(){
if CheckNetwork
then
  NPMMirror="https://registry.npmmirror.com"
else
  NPMMirror="https://registry.npmjs.org"
fi
case $(jq '.name' package.json) in
yunzai-next)
  pkg=yarn
  ;;
*)
  pkg=pnpm
  ;;
esac
if [ -e plugins/${i}/package.json ]
then
  cd plugins/${i}
  echo -e ${yellow}æ­£åœ¨å®‰è£… ${cyan}æ’ä»¶ä¾èµ–${background}
  if ${pkg} install --registry=${NPMMirror}
  then
    echo -e ${green}å®‰è£…æˆåŠŸ${background}
    return 0
  else
    echo -e ${red}å®‰è£…å¤±è´¥${background}
    return 1
  fi
  cd ..
fi
}
function gitClonePlugin(){
if [ -z "${Options}" ]
then
  getPluginList
fi
PluginNameAll=$($(TUISoftware) \
--title "${TitleText}" \
--${ChecklistMenu} "${Tips}" \
$(MenuSize) \
${Options} \
3>&1 1>&2 2>&3)
if [ $? == 1 ]
then
  return 0
fi
PluginNameAll=$(echo ${PluginNameAll} | sed 's|"||g')
if [ -z "${PluginNameAll}" ]
then
  return 0
fi
if echo ${MultipleChoice} | grep -q true
then
  for i in ${PluginNameAll}
  do
    PluginName="$(eval $(echo "jq -r '.[\"${i}\"].PluginName' ${PluginListFile}"))"
    Author="$(eval $(echo "jq -r '.[\"${i}\"].Author' ${PluginListFile}"))"
    GitURL=$(getGitURL ${i})
    echo
    echo -e ${white}==================================${background}
    echo -e ${cyan}æ­£åœ¨å®‰è£…: ${yellow}${PluginName} ${background}
    echo -e ${cyan}æ’ä»¶ä½œè€…: ${yellow}${Author} ${background}
    echo -e ${cyan}æ’ä»¶ä»“åº“: ${yellow}${GitURL} ${background}
    echo -e ${white}==================================${background}
    gitclone ${GitURL} plugins/${i}
    DependenciesInstall
  done
  echo -en ${cyan}å‘½ä»¤æ‰§è¡Œå®Œæˆ ${cyan}å›žè½¦è¿”å›ž${background};read
  echo
elif echo ${MultipleChoice} | grep -q false
then
  i=${PluginNameAll}
  PluginName="$(eval $(echo "jq -r '.[\"${i}\"].PluginName' ${PluginListFile}"))"
  Author="$(eval $(echo "jq -r '.[\"${i}\"].Author' ${PluginListFile}"))"
  Introduction="$(eval $(echo "jq -r '.[\"${i}\"].Introduction' ${PluginListFile}"))"
  GitURL=$(getGitURL ${i})
  if $($(TUISoftware) --title "${TitleText}"  \
  --yes-button "å®‰è£…" \
  --no-button "è¿”å›ž" \
  --yesno "æ’ä»¶åç§°: ${PluginName}\næ’ä»¶ä½œè€…: ${Author}\næ’ä»¶ä»‹ç»: ${Introduction}" \
  $(MsgboxSize) \
  3>&1 1>&2 2>&3)
  then
    PluginName="$(eval $(echo "jq -r '.[\"${i}\"].PluginName' ${PluginListFile}"))"
    Author="$(eval $(echo "jq -r '.[\"${i}\"].Author' ${PluginListFile}"))"
    GitURL=$(getGitURL ${i})
    echo
    echo -e ${white}==================================${background}
    echo -e ${cyan}æ­£åœ¨å®‰è£…: ${yellow}${PluginName} ${background}
    echo -e ${cyan}æ’ä»¶ä½œè€…: ${yellow}${Author} ${background}
    echo -e ${cyan}æ’ä»¶ä»“åº“: ${yellow}${GitURL} ${background}
    echo -e ${white}==================================${background}
    gitclone ${GitURL} plugins/${i}
    if DependenciesInstall
    then
      echo -en ${cyan}æ’ä»¶ ${green}å®‰è£…å®Œæˆ ${cyan}å›žè½¦è¿”å›ž${background};read
      echo
    else
      echo -en ${cyan}æ’ä»¶ ${red}å®‰è£…é”™è¯¯ ${cyan}å›žè½¦è¿”å›ž${background};read
      echo
    fi
  else
    gitClonePlugin
  fi
fi
}
function gitClonePluginSimple(){
unset Options i j n
CloudPluginNameList="$(jq -r 'keys[]' ${PluginListFile})"
for i in ${CloudPluginNameList}
do  
  PluginName="$(eval $(echo "jq -r '.[\"${i}\"].PluginName' ${PluginListFile}"))"
  Options="${Options} ${i} ${PluginName} ${OFF}"
done
PluginNameAll=$($(TUISoftware) \
--title "${TitleText}" \
--${ChecklistMenu} "${Tips}" \
$(MenuSize) \
${Options} \
3>&1 1>&2 2>&3)
if [ $? == 1 ]
then
  return 0
fi
PluginNameAll=$(echo ${PluginNameAll} | sed 's|"||g')
if [ -z "${PluginNameAll}" ]
then
  return 0
fi
if echo ${MultipleChoice} | grep -q true
then
  for i in ${PluginNameAll}
  do
    if echo ${InstalledPluginList} | grep -q ${i}
    then
      echo -e ${yellow}å·²å®‰è£… ${cyan}${i}æ’ä»¶${background}
      echo -e ${yellow}è·³è¿‡${i}æ’ä»¶çš„å®‰è£…${background}
      continue
    fi
    PluginName="$(eval $(echo "jq -r '.[\"${i}\"].PluginName' ${PluginListFile}"))"
    Author="$(eval $(echo "jq -r '.[\"${i}\"].Author' ${PluginListFile}"))"
    GitURL=$(getGitURL ${i})
    echo
    echo -e ${white}==================================${background}
    echo -e ${cyan}æ­£åœ¨å®‰è£…: ${yellow}${PluginName} ${background}
    echo -e ${cyan}æ’ä»¶ä½œè€…: ${yellow}${Author} ${background}
    echo -e ${cyan}æ’ä»¶ä»“åº“: ${yellow}${GitURL} ${background}
    echo -e ${white}==================================${background}
    gitclone ${GitURL} plugins/${i}
    DependenciesInstall
  done
  echo -en ${cyan}å‘½ä»¤æ‰§è¡Œå®Œæˆ ${cyan}å›žè½¦è¿”å›ž${background};read
  echo
elif echo ${MultipleChoice} | grep -q false
then
  if echo ${InstalledPluginList} | grep -q ${i}
  then
    echo -e ${yellow}å·²å®‰è£… ${cyan}${i}æ’ä»¶${background}
    echo -e ${yellow}è·³è¿‡${i}æ’ä»¶çš„å®‰è£…${background}
    return 0
  fi
  i=${PluginNameAll}
  PluginName="$(eval $(echo "jq -r '.[\"${i}\"].PluginName' ${PluginListFile}"))"
  Author="$(eval $(echo "jq -r '.[\"${i}\"].Author' ${PluginListFile}"))"
  Introduction="$(eval $(echo "jq -r '.[\"${i}\"].Introduction' ${PluginListFile}"))"
  GitURL=$(getGitURL ${i})
  if $($(TUISoftware) --title "${TitleText}"  \
  --yes-button "å®‰è£…" \
  --no-button "è¿”å›ž" \
  --yesno "æ’ä»¶åç§°: ${PluginName}\næ’ä»¶ä½œè€…: ${Author}\næ’ä»¶ä»‹ç»: ${Introduction}" \
  $(MsgboxSize) \
  3>&1 1>&2 2>&3)
  then
    PluginName="$(eval $(echo "jq -r '.[\"${i}\"].PluginName' ${PluginListFile}"))"
    Author="$(eval $(echo "jq -r '.[\"${i}\"].Author' ${PluginListFile}"))"
    GitURL=$(getGitURL ${i})
    echo
    echo -e ${white}==================================${background}
    echo -e ${cyan}æ­£åœ¨å®‰è£…: ${yellow}${PluginName} ${background}
    echo -e ${cyan}æ’ä»¶ä½œè€…: ${yellow}${Author} ${background}
    echo -e ${cyan}æ’ä»¶ä»“åº“: ${yellow}${GitURL} ${background}
    echo -e ${white}==================================${background}
    gitclone ${GitURL} plugins/${i}
    if DependenciesInstall
    then
      echo -en ${cyan}æ’ä»¶ ${green}å®‰è£…å®Œæˆ ${cyan}å›žè½¦è¿”å›ž${background};read
      echo
    else
      echo -en ${cyan}æ’ä»¶ ${red}å®‰è£…é”™è¯¯ ${cyan}å›žè½¦è¿”å›ž${background};read
      echo
    fi
  else
    gitClonePluginSimple
  fi
fi
}
# if $($(TUISoftware) --title "${TitleText}"  \
# --yes-button "ç®€åŒ–ç‰ˆ" \
# --no-button "æ ‡å‡†ç‰ˆ" \
# --yesno "è¯·é€‰æ‹©æ’ä»¶å±•ç¤ºçš„æ ‡å‡†" \
# $(MsgboxSize) \
# 3>&1 1>&2 2>&3)
# then
  # gitClonePlugin=gitClonePluginSimple
# else
  # gitClonePlugin=gitClonePlugin
# fi
gitClonePlugin=gitClonePlugin
if $($(TUISoftware) --title "${TitleText}"  \
--yes-button "å•é€‰" \
--no-button "å¤šé€‰" \
--yesno "è¯·é€‰æ‹©æ’ä»¶å®‰è£…æ–¹å¼" \
$(MsgboxSize) \
3>&1 1>&2 2>&3)
then
  MultipleChoice=false
  ChecklistMenu=menu
  unset OFF Tips
  ${gitClonePlugin}
else
  MultipleChoice=true
  ChecklistMenu=checklist
  OFF=OFF
  Tips="[ç©ºæ ¼é€‰æ‹© å›žè½¦ç¡®å®š ç©ºé€‰è¿”å›ž]"
  ${gitClonePlugin}
fi
}
function DeleteGitPlugin(){
unset Options PluginNameAll
if $($(TUISoftware) --title "${TitleText}"  \
--yes-button "å•é€‰" \
--no-button "å¤šé€‰" \
--yesno "è¯·é€‰æ‹©æ’ä»¶åˆ é™¤æ–¹å¼" \
$(MsgboxSize) \
3>&1 1>&2 2>&3)
then
  MultipleChoice=false
  ChecklistMenu=menu
  unset OFF Tips
else
  MultipleChoice=true
  ChecklistMenu=checklist
  OFF=OFF
  Tips="[ç©ºæ ¼é€‰æ‹© å›žè½¦ç¡®å®š ç©ºé€‰è¿”å›ž]"
fi
LocalPluginNameList="$(ls plugins -I example -I other -I system)"
for i in ${LocalPluginNameList}
do
  Options="${Options} ${i} ðŸ¥ ${OFF}"
done
PluginNameAll=$($(TUISoftware) \
--title "${TitleText}" \
--${ChecklistMenu} "${Tips}" \
$(MenuSize) \
${Options} \
3>&1 1>&2 2>&3)
if [ $? == 1 ]
then
  return 0
fi
PluginNameAll=$(echo ${PluginNameAll} | sed 's|"||g')
if [ -z "${PluginNameAll}" ]
then
  return 0
fi
if echo ${MultipleChoice} | grep -q false
then
  if $($(TUISoftware) \
  --title "${TitleText}" \
  --yes-button "åˆ é™¤" \
  --no-button "è¿”å›ž" \
  --yesno "æ˜¯å¦åˆ é™¤ ${PluginNameAll}" \
  $(MsgboxSize) \
  3>&1 1>&2 2>&3)
  then
    echo -e ${yellow}æ­£åœ¨åˆ é™¤ ${cyan}${PluginNameAll}${background}
    rm -rf plugins/${PluginNameAll}
    if [ -d plugins/${PluginNameAll} ]
    then
      echo -en ${red}åˆ é™¤å¤±è´¥ ${cyan}å›žè½¦è¿”å›ž${background};read
      echo
    else
      echo -en ${green}åˆ é™¤æˆåŠŸ ${cyan}å›žè½¦è¿”å›ž${background};read
      echo
    fi
  else
    return 0
  fi
elif echo ${MultipleChoice} | grep -q true
then 
  if $($(TUISoftware) \
  --title "${TitleText}" \
  --yes-button "åˆ é™¤" \
  --no-button "è¿”å›ž" \
  --yesno "æ˜¯å¦åˆ é™¤ ${PluginNameAll}" \ 
  $(MsgboxSize) \
  3>&1 1>&2 2>&3)
  then
    for i in ${PluginNameAll}
    do
      echo -e ${yellow}æ­£åœ¨åˆ é™¤ ${cyan}${PluginNameAll}${background}
      rm -rf plugins/${i} 2>&1 > /dev/null
      rm -rf plugins/${i} 2>&1 > /dev/null
    done
    echo -en ${green}åˆ é™¤æˆåŠŸ ${cyan}å›žè½¦è¿”å›ž${background};read
    echo
  else
    return 0
  fi
fi
}
function InstallJSPlugin(){ 
function DownloadFOLDER(){
unset Options
FOLDERPath="/sdcard/Download"
if $($(TUISoftware) --title "${TitleText}"  \
--yes-button "å•é€‰" \
--no-button "å¤šé€‰" \
--yesno "è¯·é€‰æ‹©æ’ä»¶å®‰è£…æ–¹å¼" \
$(MsgboxSize) \
3>&1 1>&2 2>&3)
then
  MultipleChoice=false
  ChecklistMenu=menu
  unset OFF Tips
else
  MultipleChoice=true
  ChecklistMenu=checklist
  OFF=OFF
  Tips="[ç©ºæ ¼é€‰æ‹© å›žè½¦ç¡®å®š ç©ºé€‰è¿”å›ž]"
fi
if [ -d ${FOLDERPath} ]
then
  if [ ! -e ${FOLDERPath}/*.js ]
  then
    $(TUISoftware) --title "${TitleText}" \
    --msgbox "æ²¡æœ‰JSæ–‡ä»¶" \
    $(MsgboxSize)
    return 0
  fi
  JSPluginList=$(ls ${FOLDERPath}/*.js | sed "s|${FOLDERPath}/||g")
  for i in ${JSPluginList}
  do
    Options="${Options} ${i} ðŸ¥ ${OFF}"
  done
  JSPluginAll=$($(TUISoftware) \
  --title "${TitleText}" \
  --${ChecklistMenu} "${Tips}" \
  $(MenuSize) \
  ${Options} \
  3>&1 1>&2 2>&3)
  if [ $? == 1 ]
  then
    return 0
  fi
  JSPluginAll=$(echo ${JSPluginAll} | sed 's|"||g')
  if [ -z "${JSPluginAll}" ]
  then
    return 0
  fi
  for i in ${JSPluginAll}
  do
    cp -f ${FOLDERPath}/${i} plugins/example
    echo -e ${cyan}${i} ${green}å®‰è£…å®Œæˆ${background}
  done
  echo -en ${green}å‘½ä»¤æ‰§è¡Œå®Œæˆ ${cyan}å›žè½¦è¿”å›ž${background};read
  echo
else
  $(TUISoftware) --title "${TitleText}" \
  --msgbox "æ–‡ä»¶å¤¹ä¸å­˜åœ¨" \
  $(MsgboxSize)
  return 0
fi
}
function GitRawURL(){
echo -en ${green}è¯·è¾“å…¥é“¾æŽ¥: ${background};read JSURL
echo
if [ -z "$JSURL" ]
then
  echo -en ${red}é”™è¯¯ ${cyan}å›žè½¦è¿”å›ž${background};read
  echo
fi
if [[ ${JSURL} == *git* ]] && [[ ${JSURL} == *.js ]]
then
JSFile=`echo ${JSURL} | awk -F/ '{print $NF}'`
  if [[ ${JSURL} = *github* ]]
  then
    JSURL=$(echo ${JSURL} | sed "s|blob/||g" | sed "s|github|raw.githubusercontent|g")
    curl -sL ${GitHubMirror}/${JSURL} > plugins/example/${JSFile}
  elif [[ ${JSURL} = *gitee* ]]
  then
    JSURL=$(echo ${JSURL} | sed 's|blob|raw|g')
    curl -sL ${JSURL} > plugins/example/${JSFile}
  fi
  echo -en ${cyan}å®‰è£…å®Œæˆ å›žè½¦è¿”å›ž${background};read
else
  echo -e ${red}é”™è¯¯ é“¾æŽ¥ä¸æ¥è‡³äºŽGitä»“åº“${background}
  echo -en ${cyan}å›žè½¦è¿”å›ž${background};read
  Main
fi
}
function QQFOLDER(){
unset Options
FOLDERPath="/sdcard/Android/data/com.tencent.mobileqq/Tencent/QQfile_recv"
if $($(TUISoftware) --title "${TitleText}"  \
--yes-button "å•é€‰" \
--no-button "å¤šé€‰" \
--yesno "è¯·é€‰æ‹©æ’ä»¶å®‰è£…æ–¹å¼" \
$(MsgboxSize) \
3>&1 1>&2 2>&3)
then
  MultipleChoice=false
  ChecklistMenu=menu
  unset OFF Tips
else
  MultipleChoice=true
  ChecklistMenu=checklist
  OFF=OFF
  Tips="[ç©ºæ ¼é€‰æ‹© å›žè½¦ç¡®å®š ç©ºé€‰è¿”å›ž]"
fi
if [ -d ${FOLDERPath}/ ]
then
  if [ ! -e ${FOLDERPath}/*.js ]
  then
    $(TUISoftware) --title "${TitleText}" \
    --msgbox "æ²¡æœ‰JSæ–‡ä»¶" \
    $(MsgboxSize)
    return 0
  fi
  JSPluginList=$(ls ${FOLDERPath}/*.js | sed 's|${FOLDERPath}/||g')
  for i in ${JSPluginList}
  do
    Options="${Options} ${i} ðŸ¥ ${OFF}"
  done
  JSPluginAll=$($(TUISoftware) \
  --title "${TitleText}" \
  --${ChecklistMenu} "${Tips}" \
  $(MenuSize) \
  ${Options} \
  3>&1 1>&2 2>&3)
  if [ $? == 1 ]
  then
    return 0
  fi
  JSPluginAll=$(echo ${JSPluginAll} | sed 's|"||g')
  if [ -z "${JSPluginAll}" ]
  then
    return 0
  fi
  for i in ${JSPluginAll}
  do
    cp -f ${FOLDERPath}/${i} plugins/example
    echo -e ${cyan}${i} ${green}å®‰è£…å®Œæˆ${background}
  done
  echo -en ${green}å‘½ä»¤æ‰§è¡Œå®Œæˆ ${cyan}å›žè½¦è¿”å›ž${background};read
  echo
else
  $(TUISoftware) --title "${TitleText}" \
  --msgbox "æ–‡ä»¶å¤¹ä¸å­˜åœ¨" \
  $(MsgboxSize)
  return 0
fi
}
function FileRaw(){
echo -en ${green}è¯·è¾“å…¥é“¾æŽ¥: ${background};read JSURL
if [[ ${JSURL} != https://* ]] && [[ ${JSURL} != *.js ]];then
  echo -e ${red}è¾“å…¥é”™è¯¯${background}
  echo -en ${cyan}å›žè½¦è¿”å›ž${background};read
  return
fi
JSFile=`echo ${JSURL} | awk -F/ '{print $NF}'`
curl -sL ${JSURL} > plugins/example/${JSFile}
echo -en ${cyan}å®‰è£…å®Œæˆ å›žè½¦è¿”å›ž${background};read
}
Number=$($(TUISoftware) \
--title "${TitleText}" \
--menu "$(MenuTips)" \
$(MenuSize) \
"1" "~/Download" \
"2" "Gitee/Github" \
"3" "QQæ–‡ä»¶å¤¹" \
"4" "æ–‡ä»¶ç›´é“¾" \
"0" "  è¿”å›ž  " \
3>&1 1>&2 2>&3)
case ${Number} in
1)
  DownloadFOLDER
  ;;
2)
  GitRawURL
  ;;
3)
  QQFOLDER
  ;;
4)
  FileRaw
  ;;
0)
  return 0
  ;;
esac
}
function DeleteJSPlugin(){
unset Options PluginNameAll
if $($(TUISoftware) --title "${TitleText}"  \
--yes-button "å•é€‰" \
--no-button "å¤šé€‰" \
--yesno "è¯·é€‰æ‹©æ’ä»¶åˆ é™¤æ–¹å¼" \
$(MsgboxSize) \
3>&1 1>&2 2>&3)
then
  MultipleChoice=false
  ChecklistMenu=menu
  unset OFF Tips
else
  MultipleChoice=true
  ChecklistMenu=checklist
  OFF=OFF
  Tips="[ç©ºæ ¼é€‰æ‹© å›žè½¦ç¡®å®š ç©ºé€‰è¿”å›ž]"
fi
JSPluginList="$(ls plugins/example)"
for i in ${JSPluginList}
do
  Options="${Options} ${i} ðŸ¥ ${OFF}"
done
PluginNameAll=$($(TUISoftware) \
--title "${TitleText}" \
--${ChecklistMenu} "${Tips}" \
$(MenuSize) \
${Options} \
3>&1 1>&2 2>&3)
if [ $? == 1 ]
then
  return 0
fi
PluginNameAll=$(echo ${PluginNameAll} | sed 's|"||g')
if [ -z "${PluginNameAll}" ]
then
  return 0
fi
if echo ${MultipleChoice} | grep -q false
then
  if $($(TUISoftware) \
  --title "${TitleText}" \
  --yes-button "åˆ é™¤" \
  --no-button "è¿”å›ž" \
  --yesno "æ˜¯å¦åˆ é™¤ ${PluginNameAll}" \
  $(MsgboxSize) \
  3>&1 1>&2 2>&3)
  then
    echo -e ${yellow}æ­£åœ¨åˆ é™¤ ${cyan}${PluginNameAll}${background}
    rm -rf plugins/example/${PluginNameAll}
    if [ -e plugins/example/${PluginNameAll} ]
    then
      echo -en ${red}åˆ é™¤å¤±è´¥ ${cyan}å›žè½¦è¿”å›ž${background};read
      echo
    else
      echo -en ${green}åˆ é™¤æˆåŠŸ ${cyan}å›žè½¦è¿”å›ž${background};read
      echo
    fi
  else
    return 0
  fi
elif echo ${MultipleChoice} | grep -q true
then
  if $($$(TUISoftware) \
  --title "${TitleText}" \
  --yes-button "åˆ é™¤" \
  --no-button "è¿”å›ž" \
  --yesno "æ˜¯å¦åˆ é™¤ ${PluginNameAll}" \
  $(MsgboxSize) \
  3>&1 1>&2 2>&3)
  then
    for i in ${PluginNameAll}
    do
      echo -e ${yellow}æ­£åœ¨åˆ é™¤ ${cyan}${PluginNameAll}${background}
      rm -rf plugins/example/${i} 2>&1 > /dev/null
      rm -rf plugins/example/${i} 2>&1 > /dev/null
    done
    echo -en ${green}åˆ é™¤æˆåŠŸ ${cyan}å›žè½¦è¿”å›ž${background};read
    echo
  else
    return 0
  fi
fi
}
function CustomInstall(){
function DependenciesInstall(){
if CheckNetwork
then
  NPMMirror="https://registry.npmjs.org"
else
  NPMMirror="https://registry.npmmirror.com"
fi
case $(jq '.name' package.json) in
yunzai-next)
  pkg=yarn
  ;;
*)
  pkg=pnpm
  ;;
esac
if [ -e plugins/${i}/package.json ]
then
  cd plugins/${i}
  echo -e ${yellow}æ­£åœ¨å®‰è£… ${cyan}æ’ä»¶ä¾èµ–${background}
  if ${pkg} install --registry=${NPMMirror}
  then
    echo -e ${green}å®‰è£…æˆåŠŸ${background}
    return 0
  else
    echo -e ${red}å®‰è£…å¤±è´¥${background}
    return 1
  fi
  cd ..
fi
}
if ! GitURL=$($(TUISoftware) --title "${TitleText}" \
--yes-button "ç¡®è®¤" \
--no-button "è¿”å›ž" \
--inputbox "è¯·è¾“å…¥Gitä»“åº“é“¾æŽ¥" \
$(MsgboxSize) \
3>&1 1>&2 2>&3)
then
  return 0
fi
if ! PluginName=$($(TUISoftware) --title "${TitleText}" \
--yes-button "ç¡®è®¤" \
--no-button "è¿”å›ž" \
--inputbox "è¯·è¾“å…¥æ–‡ä»¶å¤¹åç§°" \
$(MsgboxSize) \
3>&1 1>&2 2>&3)
then
  return 0
fi
if gitclone ${GitURL} plugins/${PluginName}
then
  DependenciesInstall
else
  echo -en ${red}å®‰è£…å¤±è´¥ ${cyan}å›žè½¦è¿”å›ž${background};read
  echo
fi
unset GitURL PluginName
}
function PluginMainMenu(){
Number=$($(TUISoftware) \
--title "${TitleText}" \
--menu "$(MenuTips)" \
$(MenuSize) \
"1" "å®‰è£…Gitæ’ä»¶" \
"2" "å¸è½½Gitæ’ä»¶" \
"3" "å®‰è£…JSæ’ä»¶" \
"4" "å¸è½½JSæ’ä»¶" \
"5" "è‡ªå®šä¹‰å®‰è£…" \
"0" "  è¿”å›ž  " \
3>&1 1>&2 2>&3)
if [ $? == 1 ]
then
  return 1
fi
case ${Number} in
1)
  InstallGitPlugin
  ;;
2)
  DeleteGitPlugin
  ;;
3)
  InstallJSPlugin
  ;;
4)
  DeleteJSPlugin
  ;;
5)
  CustomInstall
  ;;
0)
  exit 0
  ;;
esac
}
function WhilePluginMainMenu(){
  while true
  do
    PluginMainMenu
    if [ $? == 1 ]
    then
      exit 0
    fi
    WhilePluginMainMenu
  done
}
WhilePluginMainMenu